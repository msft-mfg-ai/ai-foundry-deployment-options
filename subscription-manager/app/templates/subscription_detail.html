{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
    <!-- Back button -->
    <div>
        <a href="/subscriptions" class="inline-flex items-center text-sm text-gray-500 hover:text-gray-700">
            <svg class="mr-1 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
            </svg>
            Back to Subscriptions
        </a>
    </div>

    <!-- Subscription Details -->
    <div id="subscription-detail" 
         hx-get="/api/subscriptions/{{ subscription_id }}" 
         hx-trigger="load"
         hx-swap="innerHTML">
        <!-- Loading skeleton -->
        <div class="bg-white shadow rounded-lg p-6">
            <div class="animate-pulse">
                <div class="skeleton h-8 w-64 rounded mb-4"></div>
                <div class="skeleton h-4 w-48 rounded mb-2"></div>
                <div class="skeleton h-4 w-32 rounded"></div>
            </div>
        </div>
    </div>

    <!-- Usage Chart -->
    <div class="bg-white shadow rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Token Usage Over Time</h3>
        <div class="flex items-center space-x-4 mb-4">
            <select id="time-range" 
                    class="block pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
                    hx-get="/api/usage/subscription/{{ subscription_id }}/chart"
                    hx-trigger="change"
                    hx-target="#subscription-chart"
                    hx-include="this">
                <option value="7">Last 7 days</option>
                <option value="30" selected>Last 30 days</option>
                <option value="90">Last 90 days</option>
            </select>
        </div>
        <div class="h-80" id="subscription-chart"
             hx-get="/api/usage/subscription/{{ subscription_id }}/chart?days=30"
             hx-trigger="load"
             hx-swap="innerHTML">
            <div class="flex items-center justify-center h-full">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
            </div>
        </div>
    </div>

    <!-- Daily Usage Table -->
    <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Daily Usage Details</h3>
        </div>
        <div id="daily-usage"
             hx-get="/api/usage/subscription/{{ subscription_id }}/daily"
             hx-trigger="load"
             hx-swap="innerHTML">
            <div class="p-6">
                <div class="animate-pulse space-y-3">
                    {% for i in range(7) %}
                    <div class="skeleton h-8 w-full rounded"></div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
